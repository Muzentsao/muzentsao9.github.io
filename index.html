<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>木人艸 | 點心餐盒自組系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fcfcfc; color: #333; }
        .step-container { display: none; }
        .step-container.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 品牌色系 */
        .bg-muzen-stone { background-color: #8b8c89; }
        .text-muzen-gold { color: #b0916a; }
        .border-muzen { border-color: #e5e0d8; }

        /* 盒型卡片設計 */
        .box-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border-width: 2px; }
        .box-card:hover { transform: translateY(-5px); border-color: #b0916a; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .box-card.selected { border-color: #b0916a; background-color: #fdfaf7; }

        /* 點心品項卡片 */
        .item-card { transition: all 0.2s; position: relative; }
        .item-card img { transition: transform 0.3s; }
        .item-card:hover img { transform: scale(1.05); }
        .item-card.selected { border: 2px solid #b0916a; }
        .item-card.disabled { opacity: 0.4; filter: grayscale(1); pointer-events: none; }

        /* 進度條 */
        .progress-dot.active { background-color: #b0916a; box-shadow: 0 0 0 4px rgba(176, 145, 106, 0.2); }
        
        /* PDF 列印樣式 (保留原始代碼優點) */
        @media print {
            .no-print { display: none !important; }
            .pdf-page { padding: 0 !important; border: none !important; box-shadow: none !important; }
            body { background: white; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <nav class="bg-white border-b sticky top-0 z-50 no-print">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="font-bold text-xl tracking-tighter">木人艸 <span class="text-xs font-light text-gray-400 ml-2">QUOTATION SYSTEM</span></div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <div class="progress-dot active w-3 h-3 rounded-full bg-gray-200" id="dot-1"></div>
                    <div class="progress-dot w-3 h-3 rounded-full bg-gray-200" id="dot-2"></div>
                    <div class="progress-dot w-3 h-3 rounded-full bg-gray-200" id="dot-3"></div>
                </div>
                <span class="text-sm font-medium text-gray-500" id="step-label">基本資訊</span>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-4 md:p-8">

        <div id="step-1" class="step-container active">
            <div class="bg-white rounded-2xl shadow-sm border border-muzen p-6 md:p-10">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-2">填寫訂購需求</h2>
                    <p class="text-gray-500 text-sm">請提供您的基本聯絡資訊，以便我們為您保存報價紀錄。</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-sm font-bold flex items-center gap-1">公司/單位名稱 <span class="text-red-500">*</span></label>
                        <input type="text" id="company-name" class="w-full border-gray-200 border rounded-lg p-3 focus:ring-2 focus:ring-[#b0916a] outline-none" placeholder="例：木人艸股份有限公司">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-bold">統一編號 (選填)</label>
                        <input type="text" id="tax-id" maxlength="8" class="w-full border-gray-200 border rounded-lg p-3 outline-none" placeholder="8 碼數字">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-bold flex items-center gap-1">聯絡人姓名 <span class="text-red-500">*</span></label>
                        <input type="text" id="contact-name" class="w-full border-gray-200 border rounded-lg p-3 outline-none" placeholder="請輸入姓名">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-bold flex items-center gap-1">手機號碼 <span class="text-red-500">*</span></label>
                        <input type="tel" id="contact-phone" class="w-full border-gray-200 border rounded-lg p-3 outline-none" placeholder="09XX-XXX-XXX">
                    </div>
                </div>

                <div class="mt-10 flex justify-end">
                    <button onclick="goToStep(2)" class="bg-[#333] text-white px-10 py-4 rounded-full font-bold hover:bg-black transition shadow-lg flex items-center gap-2">
                        下一步：選擇盒型與預算 <span>→</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="step-2" class="step-container">
            <div class="mb-8 text-center">
                <h2 class="text-2xl font-bold mb-2">選擇適合您的盒型</h2>
                <p class="text-gray-500 text-sm">點擊盒型即可查看對應的組合建議</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                <div class="box-card bg-white border border-gray-200 rounded-2xl p-4 text-center" onclick="selectBox('craft-4', '牛皮四格盒', 180, 4)">
                    <div class="aspect-square bg-gray-100 rounded-xl mb-4 overflow-hidden">
                        <img src="https://via.placeholder.com/300?text=CRAFT+4" class="w-full h-full object-cover">
                    </div>
                    <h3 class="font-bold">牛皮四格盒</h3>
                    <p class="text-muzen-gold font-bold">$150 - $200</p>
                    <p class="text-xs text-gray-400 mt-1">適合輕食下午茶</p>
                </div>

                <div class="box-card bg-white border border-gray-200 rounded-2xl p-4 text-center" onclick="selectBox('classic-6', '經典六格盒', 300, 6)">
                    <div class="aspect-square bg-gray-100 rounded-xl mb-4 overflow-hidden">
                        <img src="https://via.placeholder.com/300?text=CLASSIC+6" class="w-full h-full object-cover">
                    </div>
                    <h3 class="font-bold">經典六格盒</h3>
                    <p class="text-muzen-gold font-bold">$250 - $350</p>
                    <p class="text-xs text-gray-400 mt-1">會議餐點首選</p>
                </div>

                <div class="box-card bg-white border border-gray-200 rounded-2xl p-4 text-center" onclick="selectBox('marble-drawer', '大理石抽屜盒', 450, 8)">
                    <div class="aspect-square bg-gray-100 rounded-xl mb-4 overflow-hidden">
                        <img src="https://via.placeholder.com/300?text=MARBLE" class="w-full h-full object-cover">
                    </div>
                    <h3 class="font-bold">大理石抽屜盒</h3>
                    <p class="text-muzen-gold font-bold">$400 - $550</p>
                    <p class="text-xs text-gray-400 mt-1">尊爵商務活動</p>
                </div>

                <div class="box-card bg-white border border-gray-200 rounded-2xl p-4 text-center" onclick="selectBox('diamond', '美鑽盒', 600, 10)">
                    <div class="aspect-square bg-gray-100 rounded-xl mb-4 overflow-hidden">
                        <img src="https://via.placeholder.com/300?text=DIAMOND" class="w-full h-full object-cover">
                    </div>
                    <h3 class="font-bold">美鑽盒</h3>
                    <p class="text-muzen-gold font-bold">$500 - $700</p>
                    <p class="text-xs text-gray-400 mt-1">極致奢華禮贈</p>
                </div>
            </div>

            <div id="mode-selection" class="hidden animate-fade-in space-y-6">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-1 bg-white border border-muzen p-8 rounded-3xl hover:border-[#b0916a] cursor-pointer transition" onclick="setOrderMode('package')">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="text-xl font-bold">固定套餐 (Set Menu)</h4>
                            <span class="bg-gray-100 text-[10px] px-2 py-1 rounded">FAST & EASY</span>
                        </div>
                        <p class="text-gray-500 text-sm mb-6">由主廚根據時令食材搭配最完美的鹹甜比例，適合追求效率的您。</p>
                        <button class="w-full py-3 border-2 border-stone-800 rounded-full font-bold">查看主廚推薦組合</button>
                    </div>

                    <div class="flex-1 bg-stone-800 text-white p-8 rounded-3xl hover:bg-stone-900 cursor-pointer transition" onclick="setOrderMode('diy')">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="text-xl font-bold">自由配 (DIY Journey)</h4>
                            <span class="bg-[#b0916a] text-[10px] px-2 py-1 rounded">SMART ZONING</span>
                        </div>
                        <p class="text-stone-400 text-sm mb-6">透過智慧分區引導，自行挑選喜愛的品項，確保體積完美契合。</p>
                        <button class="w-full py-3 bg-[#b0916a] rounded-full font-bold">開始自由搭配</button>
                    </div>
                </div>
                <button onclick="goToStep(1)" class="text-gray-400 text-sm underline w-full text-center">返回修改資訊</button>
            </div>
        </div>

        <div id="step-3" class="step-container">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="flex-grow space-y-8">
                    <div class="bg-white p-6 rounded-2xl border border-muzen">
                        <div class="flex justify-between items-end mb-6">
                            <div>
                                <h2 id="zone-title" class="text-xl font-bold">Zone 1: 大體積品項</h2>
                                <p id="zone-desc" class="text-sm text-gray-400">請先選取 1-2 樣飽足感單品 (如鹹派、三明治)</p>
                            </div>
                            <div class="text-right">
                                <span class="text-xs text-gray-400">剩餘格子數</span>
                                <div id="slots-count" class="text-3xl font-mono font-bold text-muzen-gold">4</div>
                            </div>
                        </div>

                        <div id="items-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            </div>
                    </div>
                </div>

                <div class="w-full lg:w-80">
                    <div class="bg-white p-6 rounded-2xl border border-muzen sticky top-24">
                        <h3 class="font-bold border-b pb-4 mb-4">我的餐盒內容</h3>
                        <div id="cart-list" class="space-y-3 mb-6 min-h-[100px]">
                            <p class="text-gray-300 text-sm italic">尚未選擇品項...</p>
                        </div>
                        <div class="border-t pt-4 space-y-2">
                            <div class="flex justify-between text-sm"><span>預估單盒價</span><span id="box-price" class="font-bold">$0</span></div>
                            <div class="flex justify-between text-xs text-gray-400"><span>盒數：</span><span>100 盒</span></div>
                            <div class="flex justify-between text-xl font-bold border-t pt-2 text-red-700"><span>總計</span><span id="grand-total">$0</span></div>
                        </div>
                        <button onclick="generatePDF()" class="w-full bg-stone-800 text-white py-4 rounded-xl mt-6 font-bold hover:bg-black transition">
                            產出模擬報價單
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // 資料定義 (實際可連動 Excel 資料)
        const products = [
            { id: 'S01', name: '法式鹹派', type: 'large', price: 65, img: 'https://via.placeholder.com/150?text=Quiche' },
            { id: 'S02', name: '牛肉迷你漢堡', type: 'large', price: 75, img: 'https://via.placeholder.com/150?text=Burger' },
            { id: 'D01', name: '瑪德蓮', type: 'small', price: 45, img: 'https://via.placeholder.com/150?text=Madeleine' },
            { id: 'D02', name: '檸檬塔', type: 'small', price: 55, img: 'https://via.placeholder.com/150?text=LemonTart' },
            { id: 'D03', name: '馬卡龍', type: 'small', price: 40, img: 'https://via.placeholder.com/150?text=Macaron' },
            { id: 'D04', name: '可麗露', type: 'small', price: 60, img: 'https://via.placeholder.com/150?text=Canelé' }
        ];

        let currentState = {
            step: 1,
            boxId: '',
            boxName: '',
            maxSlots: 0,
            remainingSlots: 0,
            mode: '',
            selectedItems: [],
            totalPrice: 0,
            currentZone: 'large' // large -> small
        };

        function goToStep(step) {
            // 基本驗證
            if (step === 2 && !document.getElementById('company-name').value) {
                alert('請填寫公司名稱'); return;
            }

            document.querySelectorAll('.step-container').forEach(s => s.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            
            // 進度條控制
            document.querySelectorAll('.progress-dot').forEach((dot, idx) => {
                if (idx < step) dot.classList.add('active');
                else dot.classList.remove('active');
            });

            const labels = ["基本資訊", "選擇盒型", "搭配餐點"];
            document.getElementById('step-label').innerText = labels[step-1];
            currentState.step = step;
            window.scrollTo(0,0);
        }

        function selectBox(id, name, avgPrice, slots) {
            currentState.boxId = id;
            currentState.boxName = name;
            currentState.maxSlots = slots;
            currentState.remainingSlots = slots;
            
            // UI 反饋
            document.querySelectorAll('.box-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            document.getElementById('mode-selection').classList.remove('hidden');
            document.getElementById('slots-count').innerText = slots;
            
            // 滾動到模式選擇
            document.getElementById('mode-selection').scrollIntoView({ behavior: 'smooth' });
        }

        function setOrderMode(mode) {
            currentState.mode = mode;
            if (mode === 'diy') {
                renderItems('large');
                goToStep(3);
            } else {
                alert('固定套餐正在為您加載主廚精選圖庫...');
                // 這裡可以導向套餐展示頁
            }
        }

        function renderItems(zoneType) {
            const grid = document.getElementById('items-grid');
            grid.innerHTML = '';
            
            const filtered = products.filter(p => p.type === zoneType);
            
            filtered.forEach(p => {
                const isSelected = currentState.selectedItems.find(i => i.id === p.id);
                const card = document.createElement('div');
                card.className = `item-card border p-3 rounded-xl bg-gray-50 cursor-pointer ${isSelected ? 'selected' : ''}`;
                card.innerHTML = `
                    <div class="aspect-video rounded-lg overflow-hidden mb-2">
                        <img src="${p.img}" class="w-full h-full object-cover">
                    </div>
                    <div class="text-sm font-bold">${p.name}</div>
                    <div class="text-xs text-muzen-gold">$${p.price}</div>
                `;
                card.onclick = () => toggleItem(p);
                grid.appendChild(card);
            });

            // 更新標題
            document.getElementById('zone-title').innerText = zoneType === 'large' ? 'Zone 1: 大體積品項' : 'Zone 2: 點綴品項';
            document.getElementById('zone-desc').innerText = zoneType === 'large' ? '請先挑選主食類點心' : '請填滿剩餘的格子空間';
        }

        function toggleItem(item) {
            const index = currentState.selectedItems.findIndex(i => i.id === item.id);
            
            if (index > -1) {
                currentState.selectedItems.splice(index, 1);
                currentState.remainingSlots++;
            } else {
                if (currentState.remainingSlots <= 0) {
                    alert('盒子已經滿囉！'); return;
                }
                currentState.selectedItems.push(item);
                currentState.remainingSlots--;
            }

            // 智慧切換 Zone
            if (currentState.currentZone === 'large' && currentState.selectedItems.length >= 2) {
                currentState.currentZone = 'small';
                setTimeout(() => renderItems('small'), 300);
            }

            updateUI();
        }

        function updateUI() {
            // 格子數
            document.getElementById('slots-count').innerText = currentState.remainingSlots;
            
            // 購物籃
            const cartList = document.getElementById('cart-list');
            if (currentState.selectedItems.length === 0) {
                cartList.innerHTML = '<p class="text-gray-300 text-sm italic">尚未選擇品項...</p>';
            } else {
                cartList.innerHTML = currentState.selectedItems.map(i => `
                    <div class="flex justify-between text-sm animate-fade-in">
                        <span>${i.name}</span>
                        <span class="font-mono">$${i.price}</span>
                    </div>
                `).join('');
            }

            // 金額
            const subtotal = currentState.selectedItems.reduce((sum, i) => sum + i.price, 0);
            document.getElementById('box-price').innerText = `$${subtotal}`;
            document.getElementById('grand-total').innerText = `$${(subtotal * 100).toLocaleString()}`;
        }

        function generatePDF() {
            if (currentState.remainingSlots > 0) {
                if (!confirm(`您的盒子還能放 ${currentState.remainingSlots} 樣東西，確定要產出報價單嗎？`)) return;
            }
            alert('系統正在生成報價 PDF 並同步至木人艸後台，請點擊確認後開啟列印視窗。');
            window.print();
        }
    </script>
</body>
</html>
