<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>木人艸 | 互動式報價系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fcfcfc; color: #333; }
        .pdf-container { background-color: #fff; border: 1.5px solid #000; padding: 25px; }
        .pdf-table th, .pdf-table td { border: 1px solid #000; padding: 8px; font-size: 13px; vertical-align: middle; }
        .header-bg { background-color: #fcf4d9; font-weight: bold; }
        .text-alert { color: #d93025; font-size: 11px; line-height: 1.5; font-weight: 500; }
        .no-border-input { border: none; width: 100%; background: transparent; outline: none; padding: 4px; }
        .no-border-input:focus { background-color: #fffef0; }
        input[type="number"] { width: 55px; text-align: center; border: 1px solid #ddd; border-radius: 4px; }
        @media print { .no-print { display: none; } .pdf-container { border: none; box-shadow: none; padding: 0; } }
        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        textarea { resize: none; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-[1050px] mx-auto pdf-container shadow-2xl mb-10">
        <div class="flex justify-between items-start mb-6 border-b-2 border-black pb-4">
            <div class="text-sm">
                <h1 class="text-3xl font-bold tracking-tighter mb-1">木人艸</h1>
                <p>服務專線：02-2883-2113</p>
                <p>公司地址：台北市士林區大南路379號</p>
            </div>
            <div class="text-center">
                <h2 class="text-xl font-bold tracking-widest uppercase">木人艸股份有限公司</h2>
                <p class="text-sm text-gray-600">台灣良農食材 (會議餐點 ‧ 餐盒 ‧ 蛋糕)</p>
            </div>
            <div class="text-right text-xs text-gray-400">
                <p>修訂版本：2022/08</p>
            </div>
        </div>

        <div class="table-responsive mb-8">
            <table class="w-full pdf-table">
                <tr>
                    <td class="header-bg w-24">派單日期</td>
                    <td colspan="2"><input type="text" class="no-border-input" value="2025/11/4 0:00" readonly></td>
                    <td class="header-bg w-24">訂單編號</td>
                    <td colspan="2">Y_20250909-01</td>
                    <td class="header-bg w-24">報價業務</td>
                    <td>Yvonne</td>
                </tr>
                <tr>
                    <td class="header-bg">送餐日期</td>
                    <td colspan="2" class="text-center font-bold"><input type="text" placeholder="  月  日" class="no-border-input text-center"></td>
                    <td colspan="5" class="text-alert">
                        ● 早晨加成：若餐盒開餐時間於 9:00 以前，將另收取費用 3,500 元<br>
                        ● 夜間加成：若撤場時間 16:30-19:00，加價 1,000 元於 16:30-19:00 進行撤場
                    </td>
                </tr>
                <tr>
                    <td class="header-bg">聯絡人</td>
                    <td><input type="text" class="no-border-input" placeholder="姓名"></td>
                    <td class="header-bg w-20">公司名稱</td>
                    <td><input type="text" class="no-border-input" placeholder="抬頭"></td>
                    <td class="header-bg w-20">公司統編</td>
                    <td colspan="3"><input type="text" class="no-border-input" placeholder="8碼數字"></td>
                </tr>
                <tr>
                    <td class="header-bg">活動模式</td>
                    <td>
                        <select class="no-border-input font-bold">
                            <option value="派對餐盒">派對餐盒</option>
                            <option value="會議餐飲">會議餐飲</option>
                        </select>
                    </td>
                    <td class="header-bg w-20">用餐人數</td>
                    <td class="text-center"><input type="number" id="guest-count" class="no-border-input text-center font-bold" value="100" oninput="calculateTotal()"> 人</td>
                    <td class="header-bg w-20">手機號碼</td>
                    <td colspan="3"><input type="text" class="no-border-input" placeholder="09XX-XXX-XXX"></td>
                </tr>
                <tr>
                    <td class="header-bg">送餐地址</td>
                    <td colspan="5"><input type="text" placeholder="請輸入完整路名/門牌" class="no-border-input"></td>
                    <td class="header-bg w-20">樓層</td>
                    <td><input type="text" class="no-border-input text-center" placeholder="F"></td>
                </tr>
                <tr>
                    <td class="header-bg">地下停車場</td>
                    <td colspan="7">
                        <div class="flex items-center gap-6 px-2 py-1">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="parking" value="yes"> 有</label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="parking" value="no"> 無</label>
                            <span class="text-xs text-gray-400 font-normal">(作為物流判斷依據)</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="header-bg">備註</td>
                    <td colspan="7"><textarea id="order-remarks" class="no-border-input text-xs text-orange-700 font-bold leading-relaxed" rows="3" placeholder="司機不上樓。建議勿於室溫下放置超過2小時。"></textarea></td>
                </tr>
            </table>
        </div>

        <h3 class="text-center font-bold mb-3 tracking-widest border-b border-black pb-1 uppercase">訂購餐點明細</h3>
        <div class="table-responsive mb-8">
            <table class="w-full pdf-table">
                <thead>
                    <tr class="header-bg text-center text-xs">
                        <th class="w-20">產品類別</th>
                        <th>中文餐點名稱</th>
                        <th class="w-40">規格選擇</th>
                        <th class="w-16">盒數</th>
                        <th class="w-24">單價/盒</th>
                        <th class="w-24">小計</th>
                        <th>備註</th>
                    </tr>
                </thead>
                <tbody id="menu-body"></tbody>
            </table>
        </div>

        <h3 class="text-center font-bold mb-3 tracking-widest border-b border-black pb-1 uppercase">服務明細</h3>
        <div class="table-responsive mb-8">
            <table class="w-full pdf-table">
                <thead>
                    <tr class="header-bg text-center text-xs">
                        <th class="w-1/4">服務名稱</th>
                        <th class="w-1/2">規格說明</th>
                        <th class="w-24">小計</th>
                        <th>備註</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">人造花租賃陳列</td>
                        <td>
                            <select id="prop-rental" class="no-border-input font-bold" onchange="calculateTotal()">
                                <option value="no">無租賃需求</option>
                                <option value="yes">租賃道具 (需回收/運費$1,500)</option>
                            </select>
                        </td>
                        <td class="text-center font-medium">免費商借</td>
                        <td class="text-xs text-gray-400">一日內歸還</td>
                    </tr>
                    <tr>
                        <td class="text-center font-medium">交通費</td>
                        <td id="transport-desc">自動判定：單趟配送</td>
                        <td class="text-right font-bold" id="val-transport">$500</td>
                        <td class="text-xs text-blue-600 font-medium" id="transport-logic">金額未滿2萬且無回收</td>
                    </tr>
                    <tr>
                        <td class="text-center font-medium">人員搬運</td>
                        <td>
                            <select id="handling-type" class="no-border-input font-bold text-blue-700" onchange="calculateTotal()">
                                <option value="0">不需要 (一樓接貨)</option>
                                <option value="2000">電梯：B1-3 樓 (+$2,000)</option>
                                <option value="3500">電梯：4-6 樓 (+$3,500)</option>
                            </select>
                        </td>
                        <td class="text-right font-bold" id="val-handling">$0</td>
                        <td class="text-xs text-gray-400">*需有地下停車場</td>
                    </tr>
                    <tr>
                        <td class="text-center font-medium">餐具提供</td>
                        <td class="flex justify-between items-center italic text-gray-500">
                            <span>免費一次性餐具 (內含包材)</span>
                            <span id="utensil-info">100 組</span>
                        </td>
                        <td class="text-center text-gray-400">贈送</td>
                        <td class="text-xs text-gray-400">依人數自動帶入</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="flex flex-col md:flex-row justify-between gap-8 mt-10">
            <div class="flex-1 text-xs space-y-2 border p-4 border-black bg-gray-50 leading-relaxed">
                <p class="font-bold underline text-sm mb-2 uppercase">訂購須知</p>
                <p>1. 需於餐會前兩週支付七成定金，公司檔期以支付定金為依據。</p>
                <p>2. 刷卡需額外支付 5% 手續費。</p>
            </div>
            <div class="w-full md:w-96">
                <table class="w-full pdf-table">
                    <tr>
                        <td class="header-bg w-32">餐點小計</td>
                        <td class="text-right font-bold" id="food-total">$0</td>
                    </tr>
                    <tr>
                        <td class="header-bg">服務小計</td>
                        <td class="text-right font-bold" id="service-total">$500</td>
                    </tr>
                    <tr>
                        <td class="header-bg">營業稅 (5%)</td>
                        <td class="text-right font-bold" id="tax-total">$0</td>
                    </tr>
                    <tr class="text-xl">
                        <td class="header-bg text-red-700">總計</td>
                        <td class="text-right font-bold text-red-600" id="grand-total">$0</td>
                    </tr>
                    <tr class="text-sm">
                        <td class="header-bg">應付定金 (70%)</td>
                        <td class="text-right font-bold text-gray-700" id="deposit-total">$0</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="mt-12 flex flex-wrap gap-4 no-print justify-center">
            <button onclick="submitToMake()" class="bg-black text-white px-10 py-3 rounded-full font-bold hover:bg-gray-800 transition shadow-lg">確認並提交訂單 (JSON)</button>
            <button onclick="window.print()" class="bg-gray-100 text-gray-700 px-10 py-3 rounded-full font-bold hover:bg-gray-200 border border-gray-300">儲存 PDF / 列印</button>
        </div>
    </div>

    <script>
        // 從 PDF 完整分析導入的餐點清單 (共 38 項)
        const products = [
            // 小食系列
            { id: 'A0100204', cat: '小食', name: '照燒風味迷你漢堡(牛肉)', specs: [{ label: '中盒 (15入)', price: 1350 }, { label: '小盒 (9入)', price: 850 }] },
            { id: 'A0100202', cat: '小食', name: '照燒風味迷你漢堡(雞肉)', specs: [{ label: '中盒 (15入)', price: 1275 }, { label: '小盒 (9入)', price: 800 }] },
            { id: 'A05010020', cat: '小食', name: '鹽麴雞肉墨西哥捲餅', specs: [{ label: '中盒 (22入)', price: 1650 }, { label: '小盒 (12入)', price: 980 }] },
            { id: '303001018', cat: '小食', name: '迷你花生時蔬三明治(蛋奶素)', specs: [{ label: '中盒 (14入)', price: 560 }, { label: '小盒 (8入)', price: 350 }] },
            { id: '303001028', cat: '小食', name: '迷你燻雞時蔬三明治', specs: [{ label: '中盒 (14入)', price: 560 }, { label: '小盒 (8入)', price: 350 }] },
            { id: '303001025', cat: '小食', name: '迷你火腿起司三明治', specs: [{ label: '中盒 (14入)', price: 560 }, { label: '小盒 (8入)', price: 350 }] },
            { id: '303001004', cat: '小食', name: '復刻版迷你營養三明治', specs: [{ label: '中盒 (12入)', price: 720 }, { label: '小盒 (8入)', price: 500 }] },
            { id: '302001003', cat: '小食', name: '綜合花壽司', specs: [{ label: '中盒 (48入)', price: 960 }, { label: '小盒 (24入)', price: 550 }] },
            { id: '302001002', cat: '小食', name: '日式壽司細捲', specs: [{ label: '中盒 (96入)', price: 1440 }, { label: '小盒 (48入)', price: 800 }] },
            { id: 'A01005010', cat: '小食', name: '生態野菜鹹派(蛋奶素)', specs: [{ label: '中盒 (24入)', price: 1440 }] },
            { id: 'A05010037', cat: '小食', name: '美式炸物組合', specs: [{ label: '中盒 (炸雞/洋蔥圈)', price: 1050 }] },
            // 甜點系列
            { id: '301001005', cat: '甜點', name: '迷你棉花糖檸檬塔(蛋奶素)', specs: [{ label: '中盒 (24入)', price: 1440 }, { label: '小盒 (12入)', price: 780 }] },
            { id: 'A01014018', cat: '甜點', name: '覆盆子巧克力杯子蛋糕', specs: [{ label: '中盒 (35入)', price: 2275 }] },
            { id: 'A01014005', cat: '甜點', name: '抹茶巧克力杯子蛋糕', specs: [{ label: '中盒 (35入)', price: 2275 }] },
            { id: 'A05018010', cat: '甜點', name: '放牧雞蛋肉桂布丁麵包', specs: [{ label: '中盒 (28入)', price: 1400 }] },
            { id: '301003004', cat: '甜點', name: '繽紛馬卡龍(蛋奶素)', specs: [{ label: '中盒 (28入)', price: 840 }] },
            { id: 'A01012003', cat: '甜點', name: '日式抹茶蕨餅(蛋奶素)', specs: [{ label: '中盒 (24入)', price: 1680 }] },
            // 飲品系列 (需回收標記)
            { id: 'A09001003', cat: '飲料', name: '有機蜜香紅茶(冰桶裝)', specs: [{ label: '8公升/桶', price: 1000 }], requiresCollection: true },
            { id: 'A09003002', cat: '飲料', name: '公平貿易熱咖啡(桶裝)', specs: [{ label: '8公升/桶', price: 1500 }], requiresCollection: true }
        ];

        let cart = {};

        function init() {
            const body = document.getElementById('menu-body');
            products.forEach(p => {
                const tr = document.createElement('tr');
                tr.id = `row-${p.id}`;
                let specOptions = p.specs.map((s, idx) => `<option value="${idx}">${s.label}</option>`).join('');
                tr.innerHTML = `
                    <td class="text-center font-medium">${p.cat}</td>
                    <td class="font-bold">${p.name}</td>
                    <td><select class="no-border-input bg-gray-50 text-xs rounded" onchange="updateRow('${p.id}', this.value)">${specOptions}</select></td>
                    <td class="text-center"><input type="number" value="0" min="0" oninput="updateQty('${p.id}', this.value)"></td>
                    <td class="text-right font-medium" id="price-${p.id}">$${p.specs[0].price.toLocaleString()}</td>
                    <td class="text-right font-bold text-blue-800" id="sub-${p.id}">$0</td>
                    <td class="text-xs text-gray-400">內含基本包材</td>
                `;
                body.appendChild(tr);
            });
            calculateTotal();
        }

        function updateRow(id, specIdx) {
            const p = products.find(i => i.id === id);
            document.getElementById(`price-${id}`).innerText = `$${p.specs[specIdx].price.toLocaleString()}`;
            if (cart[id]) updateQty(id, cart[id].qty);
        }

        function updateQty(id, qty) {
            qty = Math.max(0, parseInt(qty) || 0);
            const p = products.find(i => i.id === id);
            const specIdx = document.querySelector(`#row-${id} select`).value;
            const price = p.specs[specIdx].price;
            const sub = qty * price;
            document.getElementById(`sub-${id}`).innerText = `$${sub.toLocaleString()}`;
            if (qty > 0) cart[id] = { name: p.name, qty, sub, requiresCollection: p.requiresCollection || false };
            else delete cart[id];
            calculateTotal();
        }

        function calculateTotal() {
            let foodSub = Object.values(cart).reduce((a, b) => a + b.sub, 0);
            document.getElementById('food-total').innerText = `$${foodSub.toLocaleString()}`;

            const hasBucket = Object.values(cart).some(item => item.requiresCollection);
            const hasRentalProps = document.getElementById('prop-rental').value === 'yes';
            const isRoundTrip = foodSub >= 20000 || hasBucket || hasRentalProps;
            const transportFee = isRoundTrip ? 1500 : 500;

            document.getElementById('val-transport').innerText = `$${transportFee.toLocaleString()}`;
            document.getElementById('transport-desc').innerText = isRoundTrip ? "自動判定：來回/回收" : "自動判定：單趟配送";
            document.getElementById('transport-logic').innerText = isRoundTrip ? "滿足加價條件(滿2萬/桶裝/道具)" : "金額未滿2萬且無回收";

            const handling = parseInt(document.getElementById('handling-type').value);
            const serviceSub = transportFee + handling;
            document.getElementById('service-total').innerText = `$${serviceSub.toLocaleString()}`;
            document.getElementById('utensil-info').innerText = `${document.getElementById('guest-count').value} 組`;

            const tax = Math.round((foodSub + serviceSub) * 0.05);
            const grand = foodSub + serviceSub + tax;
            document.getElementById('tax-total').innerText = `$${tax.toLocaleString()}`;
            document.getElementById('grand-total').innerText = `$${grand.toLocaleString()}`;
            document.getElementById('deposit-total').innerText = `$${Math.round(grand * 0.7).toLocaleString()}`;
        }

        function submitToMake() {
            const data = {
                order_id: "Y_20250909-01",
                customer: {
                    company: document.querySelector('input[placeholder="抬頭"]').value,
                    guests: document.getElementById('guest-count').value,
                    address: document.querySelector('input[placeholder="請輸入完整路名/門牌"]').value,
                    floor: document.querySelector('input[placeholder="F"]').value,
                    parking: document.querySelector('input[name="parking"]:checked')?.value
                },
                items: cart,
                total: document.getElementById('grand-total').innerText
            };
            console.log("JSON 資料:", data);
            alert("訂單資料已成功打包！請見瀏覽器 Console 以對接 Make.com。");
        }

        init();
    </script>
</body>
</html>
